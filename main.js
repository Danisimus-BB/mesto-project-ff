(()=>{"use strict";const e="15184d6e-c892-47df-b333-ddc708502e5f",t=t=>fetch(t,{headers:{authorization:e}});function o(t,o,n){return fetch(t,{method:o,headers:{authorization:e,"Content-Type":"application/json"}}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))).then((e=>{n.textContent=e.likes.length})).catch((e=>{console.log(e)}))}const n=document.querySelector("#card-template").content;function r(e,t,o,r,a){const c=n.querySelector(".places__item").cloneNode(!0),i=c.querySelector(".card__image"),s=c.querySelector(".card__title"),u=c.querySelector(".card__delete-button"),l=c.querySelector(".card__like-button"),p=c.querySelector(".card__like-counter");return i.src=r.link,i.alt=r.name,s.textContent=r.name,p.textContent=String(r.likes.length),a===r.owner._id?u.addEventListener("click",(()=>{e(c,r)})):c.removeChild(u),l.addEventListener("click",(()=>{t(l,p,r,a)})),i.addEventListener("click",(()=>{o(s,i)})),c}function a(t,o){var n;t.remove(),n=`https://nomoreparties.co/v1/wff-cohort-24/cards/${o._id}`,fetch(n,{method:"DELETE",headers:{authorization:e,"Content-Type":"application/json"}}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))).catch((e=>{console.log(e)}))}function c(e,t,n){e.classList.toggle("card__like-button_is-active"),e.classList.contains("card__like-button_is-active")?o(`https://nomoreparties.co/v1/wff-cohort-24/cards/likes/${n._id}`,"PUT",t):o(`https://nomoreparties.co/v1/wff-cohort-24/cards/likes/${n._id}`,"DELETE",t)}function i(e){"Escape"===e.key&&u(document.querySelector(".popup_is-opened"))}function s(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",i)}function u(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",i);const t=e.querySelectorAll("input");for(let e of t)e.value=""}const l=(e,t)=>{const o=e.querySelector(`.${t.id}-error`);t.classList.remove("popup__input_type_error"),o.classList.remove("popup__error-message_active"),o.textContent=""},p=e=>{(e=>{const t=Array.from(e.querySelectorAll(".popup__input")),o=e.querySelector(".popup__button");t.forEach((n=>{n.addEventListener("input",(function(){"link"!==n.name&&function(e){/^[a-zA-Zа-яА-Я- ]*$/.test(e.value)?(e.setCustomValidity(""),e.setAttribute("validity","valid")):(e.setCustomValidity(e.dataset.error),e.setAttribute("validity","invalid"))}(n),((e,t)=>{t.validity.valid?l(e,t):((e,t,o)=>{const n=e.querySelector(`.${t.id}-error`);t.classList.add("popup__input_type_error"),n.textContent=o,n.classList.add("popup__error-message_active")})(e,t,t.validationMessage)})(e,n),((e,t)=>{(e=>e.some((e=>!e.validity.valid)))(e)?t.setAttribute("disabled",""):t.removeAttribute("disabled","")})(t,o)}))}))})(e),e.addEventListener("submit",(function(e){e.preventDefault()}))},d=e=>{const t=Array.from(e.querySelectorAll(".popup__input"));e.querySelector(".popup__button").setAttribute("disabled",""),t.forEach((t=>{t.setCustomValidity(""),l(e,t)}))},_=document.querySelector(".places__list"),y=document.querySelectorAll(".popup"),m=document.querySelector(".profile__edit-button"),v=document.querySelector(".popup_type_edit"),f=document.querySelector(".popup_type_avatar"),h=document.querySelector(".popup_type_new-card"),S=document.querySelectorAll(".popup__close"),q=v.querySelector(".popup__form"),b=h.querySelector(".popup__form"),C=f.querySelector(".popup__form"),k=q.querySelector('input[name="name"]'),L=q.querySelector('input[name="description"]'),g=C.querySelector(".popup__input"),E=document.querySelector(".profile__title"),w=document.querySelector(".profile__image"),j=document.querySelector(".profile__description"),x=h.querySelector(".popup__input_type_card-name"),A=h.querySelector(".popup__input_type_url"),$=document.querySelector(".profile__add-button"),T=document.querySelector(".popup_type_new-card"),P=document.querySelector(".popup_type_image"),z="https://nomoreparties.co/v1/wff-cohort-24/cards",D="https://nomoreparties.co/v1/wff-cohort-24/users/me";function O(e,t){s(P);const o=P.querySelector(".popup__image"),n=P.querySelector(".popup__caption");o.src=t.src,o.alt=t.alt,n.textContent=e.textContent}!async function(){const e=await t(D),o=await e.json(),n=await t(z),i=await n.json(),s=o._id;E.textContent=o.name,j.textContent=o.about,w.style.backgroundImage=`url('${o.avatar}')`,i.forEach((e=>{const t=r(a,c,O,e,s);_.append(t)}))}(),m.addEventListener("click",(()=>{k.value=E.textContent,L.value=j.textContent,d(q),s(v),p(q)})),w.addEventListener("click",(()=>{d(f),s(f),p(f)})),$.addEventListener("click",(()=>{d(b),s(T),p(b)}));for(let e of S)e.addEventListener("click",(()=>{u(e.closest(".popup"))}));for(let e of y)e.classList.add("popup_is-animated"),e.addEventListener("click",(t=>{t.target.classList.contains("popup")&&u(e)}));q.addEventListener("submit",(t=>{t.preventDefault(),E.textContent=k.value,j.textContent=L.value,async function(){const t=q.querySelector(".popup__button");t.textContent="Сохранение...";try{await(o=D,n=k.value,r=L.value,fetch(o,{method:"PATCH",headers:{authorization:e,"Content-Type":"application/json"},body:JSON.stringify({name:n,about:r})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))).catch((e=>{console.log(e)})))}catch(e){console.error("Ошибка:",e)}finally{t.textContent="Сохранить"}var o,n,r}(),u(v)})),C.addEventListener("submit",(t=>{t.preventDefault();const o=g.value;w.style.backgroundImage=`url('${o}')`,async function(){const t=q.querySelector(".popup__button");t.textContent="Сохранение...";try{await(n=`${D}/avatar`,r=o,fetch(n,{method:"PATCH",headers:{authorization:e,"Content-Type":"application/json"},body:JSON.stringify({avatar:r})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))).catch((e=>{console.log(e)})))}catch(e){console.error("Ошибка:",e)}finally{t.textContent="Создать"}var n,r}(),u(f)})),b.addEventListener("submit",(o=>{o.preventDefault();const n={name:x.value,link:A.value};!async function(){const o=await t(D),i=(await o.json())._id,s=q.querySelector(".popup__button");s.textContent="Сохранение...";try{await function(t,o,n){return fetch(t,{method:"POST",headers:{authorization:e,"Content-Type":"application/json"},body:JSON.stringify({name:o,link:n})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))).catch((e=>{console.log(e)}))}(z,...Object.values(n))}catch(e){console.error("Ошибка:",e),s.textContent="Сохранить"}finally{const e=await t(z),o=r(a,c,O,(await e.json())[0],i);_.prepend(o),s.textContent="Сохранить"}}(),u(T),x.value="",A.value=""}))})();